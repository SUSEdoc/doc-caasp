<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Storage | Administration Guide | SUSE CaaS Platform 4.5.1</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.17 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE CaaS Platform" /><meta name="product-number" content="4.5.1" /><meta name="book-title" content="Administration Guide" /><meta name="chapter-title" content="Chapter 9. Storage" /><meta name="description" content="The Azure cloud provider can be enabled with SUSE CaaS Platform to allow Kubernetes pods to use Azure disks or Azure files as persistent volumes." /><meta name="tracker-url" content="https://github.com/SUSE/doc-caasp/issues/new" /><meta name="tracker-type" content="gh" /><meta name="tracker-gh-labels" content="AdminGuide" /><link rel="home" href="index.html" title="Administration Guide" /><link rel="up" href="index.html" title="Administration Guide" /><link rel="prev" href="_monitoring.html" title="Chapter 8. Monitoring" /><link rel="next" href="_integration.html" title="Chapter 10. Integration" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #FABEBE;"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Administration Guide"><span class="book-icon">Administration Guide</span></a><span> › </span><a class="crumb" href="_storage.html">Storage</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Administration Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pr01.html"><span class="number"> </span><span class="name"></span></a></li><li class="inactive"><a href="_about_this_guide.html"><span class="number">1 </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="_cluster_management.html"><span class="number">2 </span><span class="name">Cluster Management</span></a></li><li class="inactive"><a href="_software_management.html"><span class="number">3 </span><span class="name">Software Management</span></a></li><li class="inactive"><a href="_cluster_updates.html"><span class="number">4 </span><span class="name">Cluster Updates</span></a></li><li class="inactive"><a href="_upgrading_suse_caas_platform.html"><span class="number">5 </span><span class="name">Upgrading SUSE CaaS Platform</span></a></li><li class="inactive"><a href="_security.html"><span class="number">6 </span><span class="name">Security</span></a></li><li class="inactive"><a href="_logging.html"><span class="number">7 </span><span class="name">Logging</span></a></li><li class="inactive"><a href="_monitoring.html"><span class="number">8 </span><span class="name">Monitoring</span></a></li><li class="inactive"><a href="_storage.html"><span class="number">9 </span><span class="name">Storage</span></a></li><li class="inactive"><a href="_integration.html"><span class="number">10 </span><span class="name">Integration</span></a></li><li class="inactive"><a href="_gpu_dependent_workloads.html"><span class="number">11 </span><span class="name">GPU-Dependent Workloads</span></a></li><li class="inactive"><a href="_cluster_disaster_recovery.html"><span class="number">12 </span><span class="name">Cluster Disaster Recovery</span></a></li><li class="inactive"><a href="backup-and-restore-with-velero.html"><span class="number">13 </span><span class="name">Backup and Restore with Velero</span></a></li><li class="inactive"><a href="_miscellaneous.html"><span class="number">14 </span><span class="name">Miscellaneous</span></a></li><li class="inactive"><a href="_troubleshooting_3.html"><span class="number">15 </span><span class="name">Troubleshooting</span></a></li><li class="inactive"><a href="_glossary.html"><span class="number">16 </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="_contributors.html"><span class="number">A </span><span class="name">Contributors</span></a></li><li class="inactive"><a href="_gnu_licenses.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 8. Monitoring" href="_monitoring.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Integration" href="_integration.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #FABEBE;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Administration Guide"><span class="book-icon">Administration Guide</span></a><span> › </span><a class="crumb" href="_storage.html">Storage</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 8. Monitoring" href="_monitoring.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Integration" href="_integration.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="_storage"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname ">SUSE CaaS Platform</span> <span class="productnumber ">4.5.1</span></div><div><h1 class="title"><span class="number">9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Storage</span> <a title="Permalink" class="permalink" href="_storage.html#">#</a></h1></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="_storage.html#_azure_storage"><span class="number">9.1 </span><span class="name">Azure Storage</span></a></span></dt><dt><span class="section"><a href="_storage.html#_vsphere_storage"><span class="number">9.2 </span><span class="name">vSphere Storage</span></a></span></dt></dl></div></div><div class="sect1" id="_azure_storage"><div class="titlepage"><div><div><h2 class="title"><span class="number">9.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Azure Storage</span> <a title="Permalink" class="permalink" href="_storage.html#_azure_storage">#</a></h2></div></div></div><p>The Azure cloud provider can be enabled with SUSE CaaS Platform to allow Kubernetes pods to use Azure disks or Azure files as persistent volumes.</p><p>This chapter provides the volume usage and description.</p><p>Please refer to <a class="link" href="https://documentation.suse.com/suse-caasp/4.5/single-html/caasp-deployment/#bootstrap" target="_blank">Cluster Bootstrap</a> on how to setup Azure cloud provider enabled cluster.</p><div class="sect2" id="_azure_disk"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Azure Disk</span> <a title="Permalink" class="permalink" href="_storage.html#_azure_disk">#</a></h3></div></div></div><div class="sect3" id="create_azure_disk"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Create Disk</span> <a title="Permalink" class="permalink" href="_storage.html#create_azure_disk">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Install Azure CLI on local machine.</p><p>For installation instructions, refer to <a class="link" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" target="_blank">Install the Azure CLI</a>.</p></li><li class="listitem "><p>Create Azure disk. The <code class="literal">DISK_NAME</code> and <code class="literal">DISK_URI</code> will be used as <code class="literal">diskName</code> and <code class="literal">diskURI</code> in Kubernetes manifests for volume binding.</p><div class="verbatim-wrap"><pre class="screen">RESOURCE_GROUP="&lt;RESOURCE_GROUP_NAME&gt;"
DISK_NAME="&lt;VOLUME_NAME&gt;"
VOLUME_TYPE="&lt;VOLUME_TYPE&gt;"
VOLUME_SIZE="&lt;VOLUME_SIZE&gt;"

DISK_URI=`az disk create --resource-group ${RESOURCE_GROUP} --name ${DISK_NAME} --sku ${VOLUME_TYPE} --size-gb ${VOLUME_SIZE} --query id | cut -d'"' -f2`</pre></div><p>&lt;RESOURCE_GROUP_NAME&gt; The Azure resource group name, for example my-cluster-resource-group.</p><p>&lt;VOLUME_NAME&gt; The Azure disk name, for example my-disk.</p><p>&lt;VOLUME_TYPE&gt; The Azure storage SKU. Default value = Premium_LRS. Accepted values are Premium_LRS, StandardSSD_LRS, Standard_LRS, UltraSSD_LRS.</p><p>&lt;VOLUME_SIZE&gt; The Azure disk size to create in GB, for example 10.</p></li></ol></div></div><div class="sect3" id="_in_line_volume"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">In-line Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_in_line_volume">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create new Azure disk as described in <a class="xref" href="_storage.html#create_azure_disk" title="9.1.1.1. Create Disk">Section 9.1.1.1, “Create Disk”</a>. The disk used in pod must exist before the resource is created.</p></li><li class="listitem "><p>Create deployement - sample-disk-inline-deployment.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-inline-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-disk-inline-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        azureDisk:
          kind: Managed
          diskName: <span id="CO31-1"></span><span class="callout">1</span>
          diskURI: <span id="CO31-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The disk name, for example my-disk.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The disk resource ID.</p></td></tr></table></div></li><li class="listitem "><p>Check pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pod
...
NAME                                             READY   STATUS    RESTARTS   AGE
sample-disk-inline-deployment-549dc77d76-pwdqw   1/1     Running   0          3m42s</pre></div></li></ol></div></div><div class="sect3" id="_persistent_volume"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.1.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Persistent Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_persistent_volume">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create new Azure disk as described in <a class="xref" href="_storage.html#create_azure_disk" title="9.1.1.1. Create Disk">Section 9.1.1.1, “Create Disk”</a>. The disk used in pod must exist before the resource is created.</p></li><li class="listitem "><p>Create persistent volume.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-pv.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolume
metadata:
  name: sample-static-pv
spec:
  capacity:
    storage: 10Gi <span id="CO32-1"></span><span class="callout">1</span>
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Delete
  azureDisk:
    kind: Managed
    diskName: my-disk <span id="CO32-2"></span><span class="callout">2</span>
    diskURI: /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/resource-group-name/providers/Microsoft.Compute/disks/my-disk <span id="CO32-3"></span><span class="callout">3</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The disk size available.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The disk name.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-3"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>The disk resource ID.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-pv-pvc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-disk-pv-pvc
  labels:
    app: sample
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi <span id="CO33-1"></span><span class="callout">1</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployement.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-pv-deployment.yaml.</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-disk-pv-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO34-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-disk-pv-pvc <span id="CO34-2"></span><span class="callout">2</span>
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master</pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                STATUS   VOLUME             CAPACITY   ACCESS MODES   STORAGECLASS   AGE
sample-disk-pv-pvc   Bound    sample-disk-pv   10Gi        RWO                           55s

kubectl get pod
...
NAME                                        READY   STATUS    RESTARTS   AGE
sample-disk-pv-deployment-549dc77d76-pwdqw   1/1     Running   0          3m42s</pre></div></li></ol></div></div><div class="sect3" id="_storage_class"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.1.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Storage Class</span> <a title="Permalink" class="permalink" href="_storage.html#_storage_class">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create storage class.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-sc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sample-disk-sc
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: kubernetes.io/azure-disk
parameters:
  skuName: Standard_LRS <span id="CO35-1"></span><span class="callout">1</span>
  location: eastasia <span id="CO35-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The Azure storage SKU tier. Default is empty.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The Azure storage location. Default is empty.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim - sample-dynamic-pvc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-sc-pvc.yaml.</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-disk-sc-pvc
  labels:
    app: sample
spec:
  storageClassName: sample-disk-sc <span id="CO36-1"></span><span class="callout">1</span>
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi <span id="CO36-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The name of the storage class created.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployment.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-disk-sc-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-disk-sc-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO37-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-disk-sc-pvc <span id="CO37-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS        AGE
sample-disk-sc-pvc   Bound    pvc-0ca694b5-0084-4e36-bef1-5b2354158d79   10Gi       RWO            sample-disk-sc      70s

kubectl get pod
...
NAME                                         READY   STATUS    RESTARTS   AGE
sample-disk-sc-deployment-687765d5b5-67vnh   1/1     Running   0          20s</pre></div></li></ol></div></div></div><div class="sect2" id="_azure_file"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Azure File</span> <a title="Permalink" class="permalink" href="_storage.html#_azure_file">#</a></h3></div></div></div><div id="id-1.11.2.6.2" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important</h6><p>The <code class="literal">cifs-utils</code> package must be installed on all cluster nodes to successfully mount the Azure file share.</p><div class="verbatim-wrap"><pre class="screen">sudo zypper in cifs-utils</pre></div></div><div class="sect3" id="create_azure_fileshare_and_secret"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Create File Share and Secret</span> <a title="Permalink" class="permalink" href="_storage.html#create_azure_fileshare_and_secret">#</a></h4></div></div></div><div class="orderedlist " id="create_azure_fileshare"><ol class="orderedlist" type="1"><li class="listitem "><p><a class="link" href="https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-create-file-share?tabs=azure-portal" target="_blank">Create an Azure file share</a>.</p></li><li class="listitem "><p>Create Kubernetes file share secret.</p><div class="verbatim-wrap"><pre class="screen">RESOURCE_GROUP="&lt;RESOURCE_GROUP_NAME&gt;"
STORAGE_ACCOUNT="&lt;STORAGE_ACCOUNT_NAME&gt;"
SECRET="&lt;SECRET_NAME&gt;"

# get storage key
STORAGE_KEY=`az storage account keys list --resource-group ${RESOURCE_GROUP} --account-name ${STORAGE_ACCOUNT} --query "[0].value" -o tsv`
echo "Storage account name: "${STORAGE_ACCOUNT}
echo "Storage account key: "${STORAGE_KEY}

# create secret
kubectl create secret generic ${SECRET} --from-literal=azurestorageaccountname=${STORAGE_ACCOUNT} --from-literal=azurestorageaccountkey=${STORAGE_KEY}</pre></div><p>&lt;RESOURCE_GROUP_NAME&gt; The Azure resource group name. Must be same value as in <a class="xref" href="_storage.html#create_azure_fileshare">???TITLE???</a>.</p><p>&lt;STORAGE_ACCOUNT_NAME&gt; The Azure storage account name. Must be same value as in <a class="xref" href="_storage.html#create_azure_fileshare">???TITLE???</a>.</p><p>&lt;SECRET_NAME&gt; The Kubernetes file share secret name, for example azure-file-secret.</p></li></ol></div></div><div class="sect3" id="_in_line_volume_2"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">In-line Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_in_line_volume_2">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create new Azure file share and secret as described in <a class="xref" href="_storage.html#create_azure_fileshare_and_secret" title="9.1.2.1. Create File Share and Secret">Section 9.1.2.1, “Create File Share and Secret”</a>. The file share and secret used in pod must exist before the resource is created.</p></li><li class="listitem "><p>Create deployement.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-inline-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-file-inline-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        azureFile:
          secretName: azure-file-secret <span id="CO38-1"></span><span class="callout">1</span>
          shareName: my-cluster-file-share <span id="CO38-2"></span><span class="callout">2</span>
          readOnly: false</pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The Kubernetes file share secret name.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The Azure file share name.</p></td></tr></table></div></li><li class="listitem "><p>Check pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pod
...
NAME                                             READY   STATUS    RESTARTS   AGE
sample-file-inline-deployment-549dc77d76-pwdqw   1/1     Running   0          3m42s</pre></div></li></ol></div></div><div class="sect3" id="_persistent_volume_2"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Persistent Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_persistent_volume_2">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create new Azure file share and secret as described in <a class="xref" href="_storage.html#create_azure_fileshare_and_secret" title="9.1.2.1. Create File Share and Secret">Section 9.1.2.1, “Create File Share and Secret”</a>. The file share and secret used in pod must exist before the resource is created.</p></li><li class="listitem "><p>Create persistent volume.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-pv.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolume
metadata:
  name: sample-file-pv
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Delete
  azureFile:
      secretName: azure-file-secret <span id="CO39-1"></span><span class="callout">1</span>
      shareName: my-cluster-file-share <span id="CO39-2"></span><span class="callout">2</span>
      readOnly: false</pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The Kubernetes file share secret name.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The Azure file share name.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-pv-pvc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-file-pv-pvc
  labels:
    app: sample
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi <span id="CO40-1"></span><span class="callout">1</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO40-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployement.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-pv-deployment.yaml.</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-file-pv-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO41-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-file-pv-pvc <span id="CO41-2"></span><span class="callout">2</span>
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master</pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO41-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO41-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                STATUS   VOLUME             CAPACITY   ACCESS MODES   STORAGECLASS   AGE
sample-file-pv-pvc   Bound    sample-file-pv   10Gi        RWO                           55s

kubectl get pod
...
NAME                                        READY   STATUS    RESTARTS   AGE
sample-file-pv-deployment-549dc77d76-pwdqw   1/1     Running   0          3m42s</pre></div></li></ol></div></div><div class="sect3" id="_storage_class_2"><div class="titlepage"><div><div><h4 class="title"><span class="number">9.1.2.4 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Storage Class</span> <a title="Permalink" class="permalink" href="_storage.html#_storage_class_2">#</a></h4></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Creat RBAC for Azure file share.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-rbac.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: system:azure-cloud-provider
rules:
- apiGroups: ['']
  resources: ['secrets']
  verbs:     ['get','create']
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: system:azure-cloud-provider
roleRef:
  kind: ClusterRole
  apiGroup: rbac.authorization.k8s.io
  name: system:azure-cloud-provider
subjects:
- kind: ServiceAccount
  name: persistent-volume-binder
  namespace: kube-system</pre></div></div></li><li class="listitem "><p>Create storage class.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-sc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sample-file-sc
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: kubernetes.io/azure-file
parameters:
  skuName: Standard_LRS <span id="CO42-1"></span><span class="callout">1</span>
  location: eastasia <span id="CO42-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO42-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The Azure storage SKU tier. Default is empty.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO42-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The Azure storage location. Default is empty.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-sc-pvc.yaml.</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-file-sc-pvc
  labels:
    app: sample
spec:
  storageClassName: sample-file-sc <span id="CO43-1"></span><span class="callout">1</span>
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi <span id="CO43-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The name of the storage class created.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployment.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-file-sc-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/master
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO44-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-file-sc-pvc <span id="CO44-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS        AGE
sample-file-sc-pvc   Bound    pvc-0ca694b5-0084-4e36-bef1-5b2354158d79   10Gi       RWO            sample-file-sc      70s

kubectl get pod
...
NAME                                         READY   STATUS    RESTARTS   AGE
sample-file-sc-deployment-687765d5b5-67vnh   1/1     Running   0          20s</pre></div></li></ol></div></div></div></div><div class="sect1" id="_vsphere_storage"><div class="titlepage"><div><div><h2 class="title"><span class="number">9.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">vSphere Storage</span> <a title="Permalink" class="permalink" href="_storage.html#_vsphere_storage">#</a></h2></div></div></div><p>The vSphere cloud provider can be enabled with SUSE CaaS Platform to allow Kubernetes pods to use VMWare vSphere Virtual Machine Disk (VMDK) volumes as persistent volumes.</p><p>This chapter provides the two types of persistent volume usage and description.</p><p>Please refer to <a class="link" href="https://documentation.suse.com/suse-caasp/4.5/html/caasp-deployment/bootstrap.html" target="_blank">Cluster Bootstrap</a> on how to setup vSphere cloud provider enabled cluster.</p><div class="sect2" id="_node_meta"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.2.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Node Meta</span> <a title="Permalink" class="permalink" href="_storage.html#_node_meta">#</a></h3></div></div></div><p>Extra node meta could be found when region and zone was added to <code class="literal">vsphere.conf</code> before bootstrap cluster node.</p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">[Labels]
region = "&lt;VC_DATACENTER_TAG&gt;"
zone = "&lt;VC_CLUSTER_TAG&gt;"</pre></div></div><p><code class="literal">Region</code> refers to the datacenter and zones refers to the cluster grouping of hosts within the datacenter.
Adding region and zone makes Kubernetes persistent volume created with zone and region labels.
With such an environment, Kubernetes pod scheduler is set to be locational aware for the persistent volume.
For more information refer to: <a class="link" href="https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/zones.html" target="_blank">https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/zones.html</a>.</p><p>You can view the cloudprovider associated node meta with command.</p><div class="verbatim-wrap"><pre class="screen">kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{"\tregion: "}{.metadata.labels.failure-domain\.beta\.kubernetes\.io/region}{"\tzone: "}{.metadata.labels.failure-domain\.beta\.kubernetes\.io/zone}{"\n"}{end}'
...
010084072206    region: vcp-provo       zone: vcp-cluster-jazz
010084073045    region: vcp-provo       zone: vcp-cluster-jazz</pre></div></div><div class="sect2" id="_persistent_volume_3"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.2.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Persistent Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_persistent_volume_3">#</a></h3></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create new VMDK volume in datastore. The VMDK volume used in persistent volume must exist before the resource is created.</p><p>You can use <code class="literal">govc</code> to automate the task.</p><p>For installation instructions, refer to: <a class="link" href="https://github.com/vmware/govmomi/tree/master/govc" target="_blank">https://github.com/vmware/govmomi/tree/master/govc</a>.</p><div class="verbatim-wrap"><pre class="screen">govc datastore.disk.create -dc &lt;DATA_CENTER&gt; -ds &lt;DATA_STORE&gt; -size &lt;DISK_SIZE&gt; &lt;DISK_NAME&gt;</pre></div><p>&lt;DATA_CENTER&gt; The datacenter name in vCenter where Kubernetes nodes reside.</p><p>&lt;DATA_STORE&gt; The datastore in vCenter where volume should be created.</p><p>&lt;DISK_SIZE&gt; The volume size to create, for example 1G.</p><p>&lt;DISK_NAME&gt; The VMDK volume name. for example my-disk.vmdk, or &lt;CLUSTER_NAME&gt;-folder/my-disk.vmdk.</p></li><li class="listitem "><p>Create persistent volume - sample-static-pv.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-static-pv.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolume
metadata:
  name: sample-static-pv <span id="CO45-1"></span><span class="callout">1</span>
spec:
  capacity:
    storage: 1Gi <span id="CO45-2"></span><span class="callout">2</span>
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Delete <span id="CO45-3"></span><span class="callout">3</span>
  vsphereVolume:
    volumePath: "[datastore] volume/path" <span id="CO45-4"></span><span class="callout">4</span>
    fsType: ext4 <span id="CO45-5"></span><span class="callout">5</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The name of persistent volume resource.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The disk size available.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-3"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>The policy for how persistent volume should be handled when it is released.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-4"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>The path to VMDK volume. This path must exist.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-5"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>The file system type to mount.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim - sample-static-pvc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-static-pvc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-static-pvc
  labels:
    app: sample
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi <span id="CO46-1"></span><span class="callout">1</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployement - sample-static-deployment.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-static-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-static-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO47-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-static-pvc <span id="CO47-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO47-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO47-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                STATUS   VOLUME             CAPACITY   ACCESS MODES   STORAGECLASS   AGE
sample-static-pvc   Bound    sample-static-pv   1Gi        RWO                           55s

kubectl get pod
...
NAME                                        READY   STATUS    RESTARTS   AGE
sample-static-deployment-549dc77d76-pwdqw   1/1     Running   0          3m42s</pre></div></li></ol></div></div><div class="sect2" id="_storage_class_3"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.2.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Storage Class</span> <a title="Permalink" class="permalink" href="_storage.html#_storage_class_3">#</a></h3></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create storage class - sample-sc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-sc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sample-sc
  annotations:
    storageclass.kubernetes.io/is-default-class: "true" <span id="CO48-1"></span><span class="callout">1</span>
provisioner: kubernetes.io/vsphere-volume
parameters:
  datastore: "datastore" <span id="CO48-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>Set as the default storage class.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The datastore name in vCenter where volume should be created.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim - sample-dynamic-pvc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-dynamic-pvc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-dynamic-pvc
  annotations:
    volume.beta.kubernetes.io/storage-class: sample-sc <span id="CO49-1"></span><span class="callout">1</span>
  labels:
    app: sample
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi <span id="CO49-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO49-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>Annotate with storage class name to use the storage class created.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO49-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployment - sample-deployment.yaml</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-dynamic-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO50-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-dynamic-pvc <span id="CO50-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO50-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO50-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
sample-dynamic-pvc   Bound    pvc-0ca694b5-0084-4e36-bef1-5b2354158d79   1Gi        RWO            sample-sc      70s

kubectl get pod
...
NAME                                         READY   STATUS    RESTARTS   AGE
sample-dynamic-deployment-687765d5b5-67vnh   1/1     Running   0          20s</pre></div></li></ol></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="_integration.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 10 </span>Integration</span></a><a class="nav-link" href="_monitoring.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 8 </span>Monitoring</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2020 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>