<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Storage | Administration Guide | SUSE CaaS Platform 4.5.2</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 3.0.0 (https://opensuse.github.io/daps) using SUSE XSL Stylesheets 2.0.17 (based on DocBook XSL Stylesheets 1.79.2) - chunked" /><meta name="product-name" content="SUSE CaaS Platform" /><meta name="product-number" content="4.5.2" /><meta name="book-title" content="Administration Guide" /><meta name="chapter-title" content="Chapter 9. Storage" /><meta name="description" content="The vSphere cloud provider can be enabled with SUSE CaaS Platform to allow Kubernetes pods to use VMWare vSphere Virtual Machine Disk (VMDK) volumes as persistent storage." /><meta name="tracker-url" content="https://github.com/SUSE/doc-caasp/issues/new" /><meta name="tracker-type" content="gh" /><meta name="tracker-gh-labels" content="AdminGuide" /><link rel="home" href="index.html" title="Administration Guide" /><link rel="up" href="index.html" title="Administration Guide" /><link rel="prev" href="_monitoring.html" title="Chapter 8. Monitoring" /><link rel="next" href="_integration.html" title="Chapter 10. Integration" />
<script type="text/javascript">

if ( window.location.protocol.toLowerCase() != 'file:' ) {
  document.write('<link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css"></link>');
}
else {
  document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="https://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off" onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="bypass-block"><a href="#_content">Jump to content</a><a href="#_bottom-navigation">Jump to page navigation: previous page [access key p]/next page [access key n]</a></div><div id="_outer-wrap"><div id="_white-bg" style="background-color: #FABEBE;"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Administration Guide"><span class="book-icon">Administration Guide</span></a><span> › </span><a class="crumb" href="_storage.html">Storage</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Administration Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pr01.html"><span class="number"> </span><span class="name"></span></a></li><li class="inactive"><a href="_about_this_guide.html"><span class="number">1 </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="_cluster_management.html"><span class="number">2 </span><span class="name">Cluster Management</span></a></li><li class="inactive"><a href="_software_management.html"><span class="number">3 </span><span class="name">Software Management</span></a></li><li class="inactive"><a href="_cluster_updates.html"><span class="number">4 </span><span class="name">Cluster Updates</span></a></li><li class="inactive"><a href="_upgrading_suse_caas_platform.html"><span class="number">5 </span><span class="name">Upgrading SUSE CaaS Platform</span></a></li><li class="inactive"><a href="_security.html"><span class="number">6 </span><span class="name">Security</span></a></li><li class="inactive"><a href="_logging.html"><span class="number">7 </span><span class="name">Logging</span></a></li><li class="inactive"><a href="_monitoring.html"><span class="number">8 </span><span class="name">Monitoring</span></a></li><li class="inactive"><a href="_storage.html"><span class="number">9 </span><span class="name">Storage</span></a></li><li class="inactive"><a href="_integration.html"><span class="number">10 </span><span class="name">Integration</span></a></li><li class="inactive"><a href="_gpu_dependent_workloads.html"><span class="number">11 </span><span class="name">GPU-Dependent Workloads</span></a></li><li class="inactive"><a href="_cluster_disaster_recovery.html"><span class="number">12 </span><span class="name">Cluster Disaster Recovery</span></a></li><li class="inactive"><a href="backup-and-restore-with-velero.html"><span class="number">13 </span><span class="name">Backup and Restore with Velero</span></a></li><li class="inactive"><a href="_miscellaneous.html"><span class="number">14 </span><span class="name">Miscellaneous</span></a></li><li class="inactive"><a href="_troubleshooting_3.html"><span class="number">15 </span><span class="name">Troubleshooting</span></a></li><li class="inactive"><a href="_glossary.html"><span class="number">16 </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="_contributors.html"><span class="number">A </span><span class="name">Contributors</span></a></li><li class="inactive"><a href="_gnu_licenses.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 8. Monitoring" href="_monitoring.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Integration" href="_integration.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" style="background-color: #FABEBE;" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Administration Guide"><span class="book-icon">Administration Guide</span></a><span> › </span><a class="crumb" href="_storage.html">Storage</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 8. Monitoring" href="_monitoring.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Integration" href="_integration.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="_storage"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname ">SUSE CaaS Platform</span> <span class="productnumber ">4.5.2</span></div><div><h1 class="title"><span class="number">9 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Storage</span> <a title="Permalink" class="permalink" href="_storage.html#">#</a></h1></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="_storage.html#_vsphere_storage"><span class="number">9.1 </span><span class="name">vSphere Storage</span></a></span></dt></dl></div></div><div class="sect1" id="_vsphere_storage"><div class="titlepage"><div><div><h2 class="title"><span class="number">9.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">vSphere Storage</span> <a title="Permalink" class="permalink" href="_storage.html#_vsphere_storage">#</a></h2></div></div></div><p>The vSphere cloud provider can be enabled with SUSE CaaS Platform to allow Kubernetes pods to use VMWare vSphere Virtual Machine Disk (VMDK) volumes as persistent storage.</p><p>This chapter provides the two types of persistent volume usage and description.</p><p>Please refer to <a class="link" href="https://documentation.suse.com/suse-caasp/4.5/html/caasp-deployment/bootstrap.html" target="_blank">Cluster Bootstrap</a> on how to setup vSphere cloud provider enabled cluster.</p><div class="sect2" id="_node_meta"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.1.1 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Node Meta</span> <a title="Permalink" class="permalink" href="_storage.html#_node_meta">#</a></h3></div></div></div><p>Extra node meta could be found when region and zone was added to <code class="literal">vsphere.conf</code> before bootstrap cluster node.</p><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">[Labels]
region = "&lt;VC_DATACENTER_TAG&gt;"
zone = "&lt;VC_CLUSTER_TAG&gt;"</pre></div></div><p><code class="literal">Region</code> refers to the datacenter and zones refers to the cluster grouping of hosts within the datacenter.
Adding region and zone makes Kubernetes persistent volume created with zone and region labels.
With such an environment, Kubernetes pod scheduler is set to be locational aware for the persistent volume.
For more information refer to: <a class="link" href="https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/zones.html" target="_blank">https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/zones.html</a>.</p><p>You can view the cloudprovider associated node meta with command.</p><div class="verbatim-wrap"><pre class="screen">kubectl get nodes -o jsonpath='{range .items[*]}{.metadata.name}{"\tregion: "}{.metadata.labels.failure-domain\.beta\.kubernetes\.io/region}{"\tzone: "}{.metadata.labels.failure-domain\.beta\.kubernetes\.io/zone}{"\n"}{end}'
...
010084072206    region: vcp-provo       zone: vcp-cluster-jazz
010084073045    region: vcp-provo       zone: vcp-cluster-jazz</pre></div></div><div class="sect2" id="_static_persistent_volume"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.1.2 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Static Persistent Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_static_persistent_volume">#</a></h3></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create new VMDK volume in datastore. The VMDK volume used in persistent volume must exist before the resource is created.</p><p>You can use <code class="literal">govc</code> to automate the task.</p><p>For installation instructions, refer to: <a class="link" href="https://github.com/vmware/govmomi/tree/master/govc" target="_blank">https://github.com/vmware/govmomi/tree/master/govc</a>.</p><div class="verbatim-wrap"><pre class="screen">govc datastore.disk.create -dc &lt;DATA_CENTER&gt; -ds &lt;DATA_STORE&gt; -size &lt;DISK_SIZE&gt; &lt;DISK_NAME&gt;</pre></div><p>&lt;DATA_CENTER&gt; The datacenter name in vCenter where Kubernetes nodes reside.</p><p>&lt;DATA_STORE&gt; The datastore in vCenter where volume should be created.</p><p>&lt;DISK_SIZE&gt; The volume size to create, for example 1G.</p><p>&lt;DISK_NAME&gt; The VMDK volume name. for example my-disk.vmdk, or &lt;CLUSTER_NAME&gt;-folder/my-disk.vmdk.</p></li><li class="listitem "><p>Create persistent volume - sample-static-pv.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-static-pv.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolume
metadata:
  name: sample-static-pv <span id="CO31-1"></span><span class="callout">1</span>
spec:
  capacity:
    storage: 1Gi <span id="CO31-2"></span><span class="callout">2</span>
  accessModes:
  - ReadWriteOnce
  persistentVolumeReclaimPolicy: Delete <span id="CO31-3"></span><span class="callout">3</span>
  vsphereVolume:
    volumePath: "[datastore] volume/path" <span id="CO31-4"></span><span class="callout">4</span>
    fsType: ext4 <span id="CO31-5"></span><span class="callout">5</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The name of persistent volume resource.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The disk size available.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-3"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>The policy for how persistent volume should be handled when it is released.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-4"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>The path to VMDK volume. This path must exist.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-5"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>The file system type to mount.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim - sample-static-pvc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-static-pvc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-static-pvc
  labels:
    app: sample
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi <span id="CO32-1"></span><span class="callout">1</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployement - sample-static-deployment.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-static-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-static-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO33-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-static-pvc <span id="CO33-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                STATUS   VOLUME             CAPACITY   ACCESS MODES   STORAGECLASS   AGE
sample-static-pvc   Bound    sample-static-pv   1Gi        RWO                           55s

kubectl get pod
...
NAME                                        READY   STATUS    RESTARTS   AGE
sample-static-deployment-549dc77d76-pwdqw   1/1     Running   0          3m42s</pre></div></li></ol></div></div><div class="sect2" id="_dynamic_persistent_volume"><div class="titlepage"><div><div><h3 class="title"><span class="number">9.1.3 </span><span xmlns:dm="urn:x-suse:ns:docmanager" class="name">Dynamic Persistent Volume</span> <a title="Permalink" class="permalink" href="_storage.html#_dynamic_persistent_volume">#</a></h3></div></div></div><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>Create storage class - sample-sc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-sc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: sample-sc
  annotations:
    storageclass.kubernetes.io/is-default-class: "true" <span id="CO34-1"></span><span class="callout">1</span>
provisioner: kubernetes.io/vsphere-volume
parameters:
  datastore: "datastore" <span id="CO34-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>Set as the default storage class.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The datastore name in vCenter where volume should be created.</p></td></tr></table></div></li><li class="listitem "><p>Create persistent volume claim - sample-dynamic-pvc.yaml.</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-dynamic-pvc.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sample-dynamic-pvc
  annotations:
    volume.beta.kubernetes.io/storage-class: sample-sc <span id="CO35-1"></span><span class="callout">1</span>
  labels:
    app: sample
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi <span id="CO35-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>Annotate with storage class name to use the storage class created.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The required volume size.</p></td></tr></table></div></li><li class="listitem "><p>Create deployment - sample-deployment.yaml</p><div class="verbatim-wrap"><pre class="screen">kubectl create -f sample-deployment.yaml</pre></div><div class="informalexample"><div class="verbatim-wrap"><pre class="screen">apiVersion: apps/v1
kind: Deployment
metadata:
  name: sample-dynamic-deployment
  labels:
    app: sample
    tier: sample
spec:
  selector:
    matchLabels:
      app: sample
      tier: sample
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: sample
        tier: sample
    spec:
      containers:
      - image: busybox
        name: sample
        volumeMounts:
        - name: sample-volume
          mountPath: /data <span id="CO36-1"></span><span class="callout">1</span>
        command: [ "sleep", "infinity" ]
      volumes:
      - name: sample-volume
        persistentVolumeClaim:
          claimName: sample-dynamic-pvc <span id="CO36-2"></span><span class="callout">2</span></pre></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-1"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>The volume mount path in deployed pod.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-2"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>The requested persistent volume claim name.</p></td></tr></table></div></li><li class="listitem "><p>Check persistent volume claim is bonded and pod is running.</p><div class="verbatim-wrap"><pre class="screen">kubectl get pvc
...
NAME                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
sample-dynamic-pvc   Bound    pvc-0ca694b5-0084-4e36-bef1-5b2354158d79   1Gi        RWO            sample-sc      70s

kubectl get pod
...
NAME                                         READY   STATUS    RESTARTS   AGE
sample-dynamic-deployment-687765d5b5-67vnh   1/1     Running   0          20s</pre></div></li></ol></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="_integration.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 10 </span>Integration</span></a><a class="nav-link" href="_monitoring.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 8 </span>Monitoring</span></a></div><div class="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span class="_share-fb bottom-button">Facebook</span><span class="spacer"> • </span><span class="_share-in bottom-button">LinkedIn</span><span class="spacer"> • </span><span class="_share-tw bottom-button">Twitter</span><span class="spacer"> • </span><span class="_share-mail bottom-button">E-Mail</span></span></div><div class="print"><span class="_print-button bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2020 
        SUSE</p><ul><li><a href="https://jobs.suse.com/" target="_top">Careers</a></li><li><a href="https://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="https://www.suse.com/company/about/" target="_top">About</a></li><li><a href="https://www.suse.com/contact/" target="_top">Contact Us</a></li></ul></div></div></body></html>